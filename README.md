# LuckyMart TJ - ä¸€å…ƒå¤ºå®å¹³å°

åŸºäº Telegram çš„å¡”å‰å…‹æ–¯å¦ä¸€å…ƒå¤ºå®ç”µå•†å¹³å°ï¼Œé‡‡ç”¨ Next.js å…¨æ ˆæ¶æ„ + Supabase åç«¯ã€‚

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

- **é¡¹ç›®åç§°**: LuckyMart TJ
- **æŠ€æœ¯æ ˆ**: Next.js 14 + TypeScript + Tailwind CSS + Supabase + Telegram Bot
- **ç›®æ ‡å¸‚åœº**: å¡”å‰å…‹æ–¯å¦
- **æ”¯æŒè¯­è¨€**: ä¸­æ–‡ã€è‹±æ–‡ã€ä¿„æ–‡

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### ç”¨æˆ·ç«¯åŠŸèƒ½
- âœ… Telegram ç™»å½•è®¤è¯ï¼ˆæ–°ç”¨æˆ·èµ é€ 50 å¤ºå®å¸ï¼‰
- âœ… å•†å“æµè§ˆï¼ˆæ”¯æŒåˆ†ç±»ã€åˆ†é¡µã€å¤šè¯­è¨€ï¼‰
- âœ… å‚ä¸å¤ºå®ï¼ˆæ¯æ—¥å…è´¹ 1 æ¬¡ï¼‰
- âœ… è´¦æˆ·å……å€¼ï¼ˆæ”¯æŒ Alif Mobiã€DC Bankï¼‰
- âœ… æç°ç”³è¯·ï¼ˆæœ€ä½ 50 TJSï¼Œ5% æ‰‹ç»­è´¹ï¼‰
- âœ… æ”¶è´§åœ°å€ç®¡ç†ï¼ˆå¢åˆ æ”¹æŸ¥ã€è®¾ç½®é»˜è®¤ï¼‰
- âœ… è®¢å•ç®¡ç†ï¼ˆæŸ¥çœ‹è®¢å•ã€ç‰©æµè·Ÿè¸ªï¼‰
- âœ… è½¬å”®å¸‚åœºï¼ˆä¸€é”®è½¬å”®ã€è´­ä¹°è½¬å”®å•†å“ï¼‰
- âœ… äº¤æ˜“è®°å½•æŸ¥è¯¢

### ç®¡ç†åå°
- âœ… ç®¡ç†å‘˜ç™»å½•
- âœ… æ•°æ®ç»Ÿè®¡ä»ªè¡¨ç›˜
- âœ… è®¢å•ç®¡ç†ï¼ˆå‘è´§å¤„ç†ï¼‰
- âœ… æç°å®¡æ ¸ï¼ˆé€šè¿‡/æ‹’ç»ï¼‰
- âœ… å•†å“ç®¡ç†ï¼ˆå¾…å®Œå–„ï¼‰

### Telegram Bot
- âœ… 7 ä¸ªæ ¸å¿ƒå‘½ä»¤ï¼ˆ/start, /balance, /orders, /help, /language, /profile, /supportï¼‰
- âœ… å¤šè¯­è¨€åˆ‡æ¢
- âœ… é€šçŸ¥æ¨é€ï¼ˆä¸­å¥–ã€å‘è´§ã€æç°å®¡æ ¸ç­‰ï¼‰

### å®šæ—¶ä»»åŠ¡
- âœ… è‡ªåŠ¨å¼€å¥–ï¼ˆæ¯ 5 åˆ†é’Ÿæ£€æŸ¥å·²æ»¡æœŸæ¬¡ï¼‰
- âœ… å…è´¹æ¬¡æ•°é‡ç½®ï¼ˆæ¯æ—¥å‡Œæ™¨ï¼‰

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

### æ ¸å¿ƒæ•°æ®è¡¨ï¼ˆ14 å¼ ï¼‰
- `users` - ç”¨æˆ·è¡¨
- `user_addresses` - ç”¨æˆ·åœ°å€è¡¨
- `products` - å•†å“è¡¨
- `lottery_rounds` - å¤ºå®æœŸæ¬¡è¡¨
- `participations` - å‚ä¸è®°å½•è¡¨
- `orders` - è®¢å•è¡¨
- `transactions` - äº¤æ˜“è®°å½•è¡¨
- `resale_listings` - è½¬å”®å•†å“è¡¨
- `withdraw_requests` - æç°ç”³è¯·è¡¨
- `recharge_packages` - å……å€¼ç¤¼åŒ…è¡¨
- `notifications` - é€šçŸ¥è¡¨
- `admins` - ç®¡ç†å‘˜è¡¨

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
cd /workspace/luckymart-tj
pnpm install
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

é¡¹ç›®å·²é…ç½®å¥½ `.env.local` æ–‡ä»¶ï¼ŒåŒ…å«ï¼š
- Supabase è¿æ¥ä¿¡æ¯
- JWT å¯†é’¥
- æ•°æ®åº“è¿æ¥ï¼ˆéœ€è¦é…ç½®ï¼‰
- Telegram Bot Tokenï¼ˆéœ€è¦é…ç½®ï¼‰

**é‡è¦**: éœ€è¦é…ç½® `TELEGRAM_BOT_TOKEN`

### 3. ç”Ÿæˆ Prisma Client

```bash
npx prisma generate
```

### 4. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
pnpm dev
```

è®¿é—® http://localhost:3000

### 5. å¯åŠ¨ Telegram Botï¼ˆå¯é€‰ï¼‰

```bash
npx ts-node bot/index.ts
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
luckymart-tj/
â”œâ”€â”€ app/                      # Next.js App Router
â”‚   â”œâ”€â”€ api/                  # API è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ auth/            # è®¤è¯ API
â”‚   â”‚   â”œâ”€â”€ products/        # å•†å“ API
â”‚   â”‚   â”œâ”€â”€ lottery/         # å¤ºå® API
â”‚   â”‚   â”œâ”€â”€ user/            # ç”¨æˆ· API
â”‚   â”‚   â”œâ”€â”€ orders/          # è®¢å• API
â”‚   â”‚   â”œâ”€â”€ payment/         # æ”¯ä»˜ API
â”‚   â”‚   â”œâ”€â”€ withdraw/        # æç° API
â”‚   â”‚   â”œâ”€â”€ resale/          # è½¬å”® API
â”‚   â”‚   â””â”€â”€ admin/           # ç®¡ç†å‘˜ API
â”‚   â”œâ”€â”€ admin/               # ç®¡ç†åå°é¡µé¢
â”‚   â”œâ”€â”€ recharge/            # å……å€¼é¡µé¢
â”‚   â”œâ”€â”€ withdraw/            # æç°é¡µé¢
â”‚   â”œâ”€â”€ addresses/           # åœ°å€ç®¡ç†é¡µé¢
â”‚   â”œâ”€â”€ resale/              # è½¬å”®å¸‚åœºé¡µé¢
â”‚   â”œâ”€â”€ profile/             # ä¸ªäººä¸­å¿ƒ
â”‚   â””â”€â”€ orders/              # è®¢å•åˆ—è¡¨
â”œâ”€â”€ lib/                     # æ ¸å¿ƒå·¥å…·åº“
â”‚   â”œâ”€â”€ supabase.ts         # Supabase å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ auth.ts             # è®¤è¯å·¥å…·
â”‚   â”œâ”€â”€ utils.ts            # é€šç”¨å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ lottery.ts          # å¼€å¥–ç®—æ³•ï¼ˆVRFï¼‰
â”œâ”€â”€ types/                   # TypeScript ç±»å‹å®šä¹‰
â”œâ”€â”€ bot/                     # Telegram Bot
â”‚   â””â”€â”€ index.ts            # Bot ä¸»æ–‡ä»¶
â”œâ”€â”€ supabase/               # Supabase é…ç½®
â”‚   â””â”€â”€ functions/          # Edge Functions
â”‚       â”œâ”€â”€ auto-draw/      # è‡ªåŠ¨å¼€å¥–ä»»åŠ¡
â”‚       â””â”€â”€ reset-free-count/ # é‡ç½®å…è´¹æ¬¡æ•°
â””â”€â”€ prisma/                 # Prisma é…ç½®
    â””â”€â”€ schema.prisma       # æ•°æ®åº“ Schema
```

## ğŸ”‘ æ ¸å¿ƒ API ç«¯ç‚¹

### è®¤è¯
- `POST /api/auth/telegram` - Telegram ç™»å½•/æ³¨å†Œ

### å•†å“
- `GET /api/products/list` - å•†å“åˆ—è¡¨
- `GET /api/products/[id]` - å•†å“è¯¦æƒ…

### å¤ºå®
- `POST /api/lottery/participate` - å‚ä¸å¤ºå®
- `POST /api/lottery/draw` - å¼€å¥–ï¼ˆè‡ªåŠ¨è§¦å‘ï¼‰

### ç”¨æˆ·
- `GET /api/user/profile` - ç”¨æˆ·èµ„æ–™
- `GET /api/user/addresses` - åœ°å€åˆ—è¡¨
- `POST /api/user/addresses` - åˆ›å»ºåœ°å€
- `PUT /api/user/addresses/[id]` - æ›´æ–°åœ°å€
- `DELETE /api/user/addresses/[id]` - åˆ é™¤åœ°å€

### è®¢å•
- `GET /api/orders/list` - è®¢å•åˆ—è¡¨
- `GET /api/orders/[id]` - è®¢å•è¯¦æƒ…

### æ”¯ä»˜
- `GET /api/payment/packages` - å……å€¼ç¤¼åŒ…åˆ—è¡¨
- `POST /api/payment/recharge` - åˆ›å»ºå……å€¼è®¢å•

### æç°
- `POST /api/withdraw/create` - åˆ›å»ºæç°ç”³è¯·
- `GET /api/withdraw/list` - æç°è®°å½•

### è½¬å”®
- `POST /api/resale/create` - åˆ›å»ºè½¬å”®
- `GET /api/resale/list` - è½¬å”®å•†å“åˆ—è¡¨
- `POST /api/resale/purchase/[id]` - è´­ä¹°è½¬å”®å•†å“

### ç®¡ç†å‘˜
- `POST /api/admin/login` - ç®¡ç†å‘˜ç™»å½•
- `GET /api/admin/orders` - è®¢å•åˆ—è¡¨
- `POST /api/admin/orders` - å‘è´§å¤„ç†
- `GET /api/admin/withdrawals` - æç°åˆ—è¡¨
- `POST /api/admin/withdrawals` - æç°å®¡æ ¸

## ğŸ¨ å‰ç«¯é¡µé¢

### ç”¨æˆ·ç«¯
- `/` - é¦–é¡µï¼ˆå•†å“åˆ—è¡¨ï¼‰
- `/product/[id]` - å•†å“è¯¦æƒ…
- `/profile` - ä¸ªäººä¸­å¿ƒ
- `/recharge` - å……å€¼é¡µé¢
- `/withdraw` - æç°é¡µé¢
- `/addresses` - åœ°å€ç®¡ç†
- `/resale` - è½¬å”®å¸‚åœº
- `/orders` - è®¢å•åˆ—è¡¨

### ç®¡ç†åå°
- `/admin` - ç™»å½•é¡µ
- `/admin/dashboard` - ä»ªè¡¨ç›˜
- `/admin/orders` - è®¢å•ç®¡ç†
- `/admin/withdrawals` - æç°å®¡æ ¸
- `/admin/products` - å•†å“ç®¡ç†ï¼ˆå¾…å®Œå–„ï¼‰

## ğŸ¤– Telegram Bot å‘½ä»¤

- `/start` - å¼€å§‹ä½¿ç”¨ï¼Œæ‰“å¼€ Mini App
- `/balance` - æŸ¥è¯¢ä½™é¢
- `/orders` - æŸ¥çœ‹è®¢å•
- `/profile` - ä¸ªäººèµ„æ–™
- `/language` - åˆ‡æ¢è¯­è¨€ï¼ˆä¸­è‹±ä¿„ï¼‰
- `/help` - å¸®åŠ©ä¿¡æ¯
- `/support` - è”ç³»å®¢æœ

## â° å®šæ—¶ä»»åŠ¡

### è‡ªåŠ¨å¼€å¥–
- **é¢‘ç‡**: æ¯ 5 åˆ†é’Ÿ
- **åŠŸèƒ½**: æ£€æŸ¥å·²æ»¡çš„å¤ºå®æœŸæ¬¡å¹¶è‡ªåŠ¨å¼€å¥–
- **æ–‡ä»¶**: `supabase/functions/auto-draw/index.ts`

### å…è´¹æ¬¡æ•°é‡ç½®
- **é¢‘ç‡**: æ¯å¤©å‡Œæ™¨ 0:00
- **åŠŸèƒ½**: é‡ç½®æ‰€æœ‰ç”¨æˆ·çš„å…è´¹å¤ºå®æ¬¡æ•°ä¸º 1
- **æ–‡ä»¶**: `supabase/functions/reset-free-count/index.ts`

## ğŸ” å®‰å…¨ç‰¹æ€§

- JWT Token è®¤è¯
- Telegram WebApp æ•°æ®éªŒè¯ï¼ˆHMAC-SHA256ï¼‰
- VRF å¯éªŒè¯éšæœºå¼€å¥–ç®—æ³•
- ç®¡ç†å‘˜æƒé™éªŒè¯
- SQL æ³¨å…¥é˜²æŠ¤ï¼ˆPrisma ORMï¼‰

## ğŸ’³ æ”¯ä»˜é›†æˆ

ç›®å‰æ”¯æŒæ¨¡æ‹Ÿæ”¯ä»˜ï¼Œé¢„ç•™çœŸå®æ”¯ä»˜æ¥å£ï¼š
- **Alif Mobi**: å¡”å‰å…‹æ–¯å¦ä¸»æµç§»åŠ¨æ”¯ä»˜
- **DC Bank**: é“¶è¡Œè½¬è´¦

## ğŸ“Š ä¸šåŠ¡æµç¨‹

### å¤ºå®æµç¨‹
1. ç”¨æˆ·æµè§ˆå•†å“
2. é€‰æ‹©å•†å“å‚ä¸å¤ºå®ï¼ˆæ¶ˆè€—å¤ºå®å¸æˆ–ä½¿ç”¨å…è´¹æ¬¡æ•°ï¼‰
3. ç³»ç»Ÿåˆ†é…å‚ä¸å·ç 
4. æœŸæ¬¡å”®ç½„åè‡ªåŠ¨å¼€å¥–
5. ä¸­å¥–ç”¨æˆ·æ”¶åˆ°é€šçŸ¥
6. å¡«å†™æ”¶è´§åœ°å€
7. ç®¡ç†å‘˜å‘è´§
8. ç”¨æˆ·æ”¶è´§æˆ–é€‰æ‹©è½¬å”®

### å……å€¼æµç¨‹
1. ç”¨æˆ·é€‰æ‹©å……å€¼ç¤¼åŒ…
2. é€‰æ‹©æ”¯ä»˜æ–¹å¼ï¼ˆAlif Mobi / DC Bankï¼‰
3. å®Œæˆæ”¯ä»˜
4. è”ç³»å®¢æœæ ¸é”€
5. ç³»ç»Ÿåˆ°è´¦

### æç°æµç¨‹
1. ç”¨æˆ·æäº¤æç°ç”³è¯·
2. ç³»ç»Ÿæ‰£é™¤é‡‘é¢å’Œæ‰‹ç»­è´¹
3. ç®¡ç†å‘˜å®¡æ ¸
4. å®¡æ ¸é€šè¿‡å 1-3 ä¸ªå·¥ä½œæ—¥åˆ°è´¦
5. å®¡æ ¸æ‹’ç»åˆ™é€€å›é‡‘é¢

### è½¬å”®æµç¨‹
1. ä¸­å¥–ç”¨æˆ·åˆ›å»ºè½¬å”®ï¼ˆè®¾ç½®è½¬å”®ä»·æ ¼ï¼‰
2. å•†å“ä¸Šæ¶è½¬å”®å¸‚åœº
3. å…¶ä»–ç”¨æˆ·è´­ä¹°
4. ç³»ç»Ÿè‡ªåŠ¨å¤„ç†äº¤æ˜“
5. å–å®¶è·å¾—è½¬å”®æ”¶å…¥
6. ä¹°å®¶è·å¾—å•†å“

## ğŸ› è°ƒè¯•ä¸æ—¥å¿—

- å‰ç«¯ï¼šæµè§ˆå™¨æ§åˆ¶å°
- åç«¯ APIï¼šNext.js æ§åˆ¶å°
- Telegram Botï¼šBot è¿è¡Œæ—¥å¿—
- Supabase Functionsï¼šSupabase Dashboard æ—¥å¿—

## ğŸ“ å¾…å®Œå–„åŠŸèƒ½

- [ ] å•†å“ç®¡ç†é¡µé¢ï¼ˆä¸Šä¼ å›¾ç‰‡ã€ç¼–è¾‘å•†å“ï¼‰
- [ ] æ•°æ®ç»Ÿè®¡é¡µé¢ï¼ˆæ›´è¯¦ç»†çš„è¿è¥æ•°æ®ï¼‰
- [ ] çœŸå®æ”¯ä»˜é›†æˆï¼ˆAlif Mobiã€DC Bank APIï¼‰
- [ ] å¤šè¯­è¨€æ–‡ä»¶å®Œå–„
- [ ] å•å…ƒæµ‹è¯•
- [ ] E2E æµ‹è¯•
- [ ] ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

## ğŸš¢ éƒ¨ç½²è¯´æ˜

### Vercel éƒ¨ç½²ï¼ˆæ¨èï¼‰
1. è¿æ¥ GitHub ä»“åº“
2. é…ç½®ç¯å¢ƒå˜é‡
3. è‡ªåŠ¨éƒ¨ç½²

### Supabase Edge Functions éƒ¨ç½²
```bash
# è‡ªåŠ¨å¼€å¥–
supabase functions deploy auto-draw

# å…è´¹æ¬¡æ•°é‡ç½®
supabase functions deploy reset-free-count
```

### Telegram Bot éƒ¨ç½²
å»ºè®®ä½¿ç”¨ PM2 æˆ– systemd ä¿æŒ Bot è¿è¡Œï¼š
```bash
pm2 start bot/index.ts --name luckymart-bot
pm2 save
pm2 startup
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

- **å¼€å‘è€…**: MiniMax Agent
- **é—®é¢˜åé¦ˆ**: è¯·åœ¨ GitHub æäº¤ Issue
- **Telegram æ”¯æŒ**: @LuckyMartSupport

## ğŸ“„ è®¸å¯è¯

MIT License

---

**å¼€å‘æ—¶é—´**: 2025-10-28  
**ç‰ˆæœ¬**: v2.0  
**çŠ¶æ€**: å¼€å‘å®Œæˆï¼Œå¾…æµ‹è¯•éƒ¨ç½²
