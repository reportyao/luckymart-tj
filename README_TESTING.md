# LuckyMart TJ æµ‹è¯•æ¡†æ¶

![æµ‹è¯•çŠ¶æ€](https://img.shields.io/badge/æµ‹è¯•çŠ¶æ€-å·²é…ç½®-brightgreen)
![è¦†ç›–ç‡ç›®æ ‡](https://img.shields.io/badge/è¦†ç›–ç‡ç›®æ ‡-90%25-blue)
![æµ‹è¯•æ–‡ä»¶æ•°](https://img.shields.io/badge/æµ‹è¯•æ–‡ä»¶-26ä¸ª-orange)

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

LuckyMart TJ å¤šå±‚çº§è£‚å˜ç³»ç»Ÿçš„å®Œæ•´æµ‹è¯•æ¡†æ¶ï¼Œæä¾›å…¨é¢çš„å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•å’Œè¦†ç›–ç‡åˆ†æã€‚

## ğŸ—ï¸ æ¡†æ¶æ¶æ„

```
luckymart-tj/
â”œâ”€â”€ __tests__/                    # æµ‹è¯•æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ referral-system-integration.test.ts      # é‚€è¯·ç³»ç»Ÿé›†æˆæµ‹è¯•
â”‚   â”œâ”€â”€ referral-reward-trigger.test.ts          # å¥–åŠ±è§¦å‘æœºåˆ¶æµ‹è¯•
â”‚   â”œâ”€â”€ referral-calc-rebate.test.ts             # è¿”åˆ©è®¡ç®—ç²¾åº¦æµ‹è¯•
â”‚   â”œâ”€â”€ auth.test.ts                              # è®¤è¯æµ‹è¯•
â”‚   â”œâ”€â”€ business-flow.test.ts                     # ä¸šåŠ¡æµç¨‹æµ‹è¯•
â”‚   â”œâ”€â”€ lottery-algorithm.test.ts                 # æŠ½å¥–ç®—æ³•æµ‹è¯•
â”‚   â”œâ”€â”€ api-security.test.ts                      # APIå®‰å…¨æµ‹è¯•
â”‚   â””â”€â”€ ... (å…±26ä¸ªæµ‹è¯•æ–‡ä»¶)
â”œâ”€â”€ test/                       # æµ‹è¯•ç›¸å…³æ–‡ä»¶
â”‚   â””â”€â”€ init-test-data.sql      # æµ‹è¯•æ•°æ®åˆå§‹åŒ–è„šæœ¬
â”œâ”€â”€ test-results/               # æµ‹è¯•ç»“æœç›®å½•
â”‚   â”œâ”€â”€ coverage/               # è¦†ç›–ç‡æŠ¥å‘Š
â”‚   â”œâ”€â”€ test-execution-*.log    # æµ‹è¯•æ‰§è¡Œæ—¥å¿—
â”‚   â””â”€â”€ test-summary-*.md       # æµ‹è¯•æ€»ç»“æŠ¥å‘Š
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ run-tests.sh            # è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬
â”œâ”€â”€ jest.config.js              # Jesté…ç½®
â”œâ”€â”€ jest.setup.js               # æµ‹è¯•ç¯å¢ƒè®¾ç½®
â”œâ”€â”€ TESTING_FRAMEWORK_COMPLETION_REPORT.md    # å®ŒæˆæŠ¥å‘Š
â”œâ”€â”€ TESTING_ENVIRONMENT_SETUP_GUIDE.md        # ç¯å¢ƒé…ç½®æŒ‡å—
â””â”€â”€ README.md                   # æœ¬æ–‡æ¡£
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

```bash
# å®‰è£…ä¾èµ–
npm install

# ç”ŸæˆPrismaå®¢æˆ·ç«¯
npm run prisma:generate
```

### 2. é…ç½®æµ‹è¯•ç¯å¢ƒ

åˆ›å»º `.env.local` æ–‡ä»¶ï¼š

```bash
NODE_ENV=test
DATABASE_URL="postgresql://postgres:[å¯†ç ]@aws-0-ap-southeast-1.pooler.supabase.com:6543/postgres"
JWT_SECRET="test-jwt-secret-for-testing-only"
TELEGRAM_BOT_TOKEN="test-bot-token-for-testing"
```

è¯¦ç»†é…ç½®è¯·å‚è€ƒï¼š[TESTING_ENVIRONMENT_SETUP_GUIDE.md](./TESTING_ENVIRONMENT_SETUP_GUIDE.md)

### 3. è¿è¡Œæµ‹è¯•

```bash
# ä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬ï¼ˆæ¨èï¼‰
./scripts/run-tests.sh

# æˆ–ç›´æ¥ä½¿ç”¨npmå‘½ä»¤
npm test                    # è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm run test:coverage      # è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
```

## ğŸ“Š æµ‹è¯•è¦†ç›–èŒƒå›´

### æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•

| æ¨¡å— | æµ‹è¯•æ–‡ä»¶ | æµ‹è¯•æ•°é‡ | è¦†ç›–ç‡ç›®æ ‡ |
|------|----------|----------|------------|
| **é‚€è¯·ç³»ç»Ÿ** | `referral-system-integration.test.ts` | 15+ | 90% |
| **å¥–åŠ±æœºåˆ¶** | `referral-reward-trigger.test.ts` | 20+ | 90% |
| **è¿”åˆ©è®¡ç®—** | `referral-calc-rebate.test.ts` | 25+ | 90% |
| **è®¤è¯ç³»ç»Ÿ** | `auth.test.ts` | 10+ | 90% |
| **ä¸šåŠ¡æµç¨‹** | `business-flow.test.ts` | 12+ | 90% |
| **æŠ½å¥–ç®—æ³•** | `lottery-algorithm.test.ts` | 8+ | 90% |
| **APIå®‰å…¨** | `api-security.test.ts` | 15+ | 90% |

### æµ‹è¯•ç±»å‹åˆ†å¸ƒ

- **å•å…ƒæµ‹è¯•**: 70% (æµ‹è¯•å•ä¸ªå‡½æ•°/ç»„ä»¶)
- **é›†æˆæµ‹è¯•**: 25% (æµ‹è¯•æ¨¡å—é—´äº¤äº’)
- **ç«¯åˆ°ç«¯æµ‹è¯•**: 5% (æµ‹è¯•å®Œæ•´ä¸šåŠ¡æµç¨‹)

### æ€§èƒ½æµ‹è¯•

| æµ‹è¯•ç±»å‹ | æµ‹è¯•æ–‡ä»¶ | åŸºå‡†æŒ‡æ ‡ |
|----------|----------|----------|
| ç¼“å­˜æ€§èƒ½ | `performance-cache.test.ts` | < 100ms |
| é‚€è¯·æ€§èƒ½ | `referral-performance.test.ts` | < 500ms |
| å¹¶å‘å¤„ç† | `referral-load-testing.test.ts` | 1000 req/s |
| æ•°æ®åº“é” | `database-lock.test.ts` | < 50ms |

## ğŸ› ï¸ æµ‹è¯•å·¥å…·å’Œé…ç½®

### Jesté…ç½®ç‰¹æ€§

- **è¦†ç›–ç‡é˜ˆå€¼**: 90% (åˆ†æ”¯ã€å‡½æ•°ã€è¡Œã€è¯­å¥)
- **å¹¶è¡Œæ‰§è¡Œ**: 50% çº¿ç¨‹åˆ©ç”¨ç‡
- **æµ‹è¯•è¶…æ—¶**: 30ç§’
- **è¦†ç›–ç‡æŠ¥å‘Š**: HTMLã€LCOVã€JSONã€Clover
- **æºç æ”¶é›†**: å…¨é¢çš„TypeScript/TSXæ–‡ä»¶è¦†ç›–

### æµ‹è¯•å·¥å…·ç±»

#### `test-config.ts`
- `TestDataGenerator`: æµ‹è¯•æ•°æ®ç”Ÿæˆå™¨
- `PerformanceTester`: æ€§èƒ½æµ‹è¯•å·¥å…·
- `MockDataGenerator`: æ¨¡æ‹Ÿæ•°æ®ç”Ÿæˆ
- `TestCleanup`: æµ‹è¯•æ¸…ç†å·¥å…·

#### `test-utils.ts`
- `MockRequest/Response`: APIæµ‹è¯•æ¨¡æ‹Ÿå¯¹è±¡
- `AssertionHelpers`: æ–­è¨€è¾…åŠ©å‡½æ•°
- `PerformanceUtils`: æ€§èƒ½æµ‹è¯•å·¥å…·

## ğŸ“ˆ è¦†ç›–ç‡æŠ¥å‘Š

### æŠ¥å‘Šæ ¼å¼

1. **HTMLæŠ¥å‘Š** (`test-results/coverage/index.html`)
   - å¯è§†åŒ–è¦†ç›–ç‡ç•Œé¢
   - è¯¦ç»†æ–‡ä»¶çº§åˆ«è¦†ç›–æƒ…å†µ
   - æœªè¦†ç›–ä»£ç è¡Œé«˜äº®æ˜¾ç¤º

2. **LCOVæŠ¥å‘Š** (`test-results/coverage/lcov.info`)
   - ä»£ç è¦†ç›–æ•°æ®
   - CI/CDé›†æˆå‹å¥½

3. **JSONæŠ¥å‘Š** (`test-results/coverage/coverage-final.json`)
   - æœºå™¨å¯è¯»æ ¼å¼
   - ç¨‹åºåŒ–åˆ†æä½¿ç”¨

### è¦†ç›–ç‡æŒ‡æ ‡

```javascript
// jest.config.js ä¸­çš„é˜ˆå€¼é…ç½®
coverageThreshold: {
  global: {
    branches: 90,    // åˆ†æ”¯è¦†ç›–ç‡
    functions: 90,   // å‡½æ•°è¦†ç›–ç‡
    lines: 90,       // è¡Œè¦†ç›–ç‡
    statements: 90   // è¯­å¥è¦†ç›–ç‡
  }
}
```

## ğŸ”§ è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬

### `scripts/run-tests.sh` åŠŸèƒ½

- âœ… ç¯å¢ƒæ£€æŸ¥å’ŒéªŒè¯
- âœ… æ•°æ®åº“è¿æ¥æµ‹è¯•
- âœ… æµ‹è¯•æ•°æ®åˆå§‹åŒ–
- âœ… æµ‹è¯•æ‰§è¡Œå’Œç›‘æ§
- âœ… è¦†ç›–ç‡æŠ¥å‘Šç”Ÿæˆ
- âœ… é”™è¯¯æ—¥å¿—è®°å½•

### ä½¿ç”¨ç¤ºä¾‹

```bash
# å®Œæ•´æµ‹è¯•å¥—ä»¶
./scripts/run-tests.sh

# ç‰¹å®šæµ‹è¯•ç±»å‹
./scripts/run-tests.sh --unit          # å•å…ƒæµ‹è¯•
./scripts/run-tests.sh --integration   # é›†æˆæµ‹è¯•
./scripts/run-tests.sh --performance   # æ€§èƒ½æµ‹è¯•

# è¾…åŠ©åŠŸèƒ½
./scripts/run-tests.sh --clean         # æ¸…ç†æµ‹è¯•ç¯å¢ƒ
./scripts/run-tests.sh --help          # æ˜¾ç¤ºå¸®åŠ©
```

## ğŸ“ æµ‹è¯•æ–‡ä»¶è¯´æ˜

### é‚€è¯·ç³»ç»Ÿæµ‹è¯• (8ä¸ªæ–‡ä»¶)

| æ–‡ä»¶å | ä¸»è¦åŠŸèƒ½ | æµ‹è¯•åœºæ™¯ |
|--------|----------|----------|
| `referral-system-integration.test.ts` | æ ¸å¿ƒé‚€è¯·ä¸šåŠ¡æµç¨‹ | é‚€è¯·ç ç”Ÿæˆã€ç”¨æˆ·ç»‘å®šã€å¥–åŠ±å‘æ”¾ |
| `referral-reward-trigger.test.ts` | å¥–åŠ±è§¦å‘æœºåˆ¶ | è§¦å‘æ¡ä»¶ã€è®¡ç®—é€»è¾‘ã€å‘æ”¾æ—¶æœº |
| `referral-calc-rebate.test.ts` | å°æ•°ç²¾åº¦è¿”åˆ©è®¡ç®— | ç²¾åº¦å¤„ç†ã€è¾¹ç•Œå€¼ã€æ€§èƒ½æµ‹è¯• |
| `referral-bot-integration.test.ts` | æœºå™¨äººé›†æˆæµ‹è¯• | Telegram Botäº¤äº’ã€é€šçŸ¥å‘é€ |
| `referral-load-testing.test.ts` | è´Ÿè½½æµ‹è¯• | é«˜å¹¶å‘ã€å¤§æ•°æ®é‡å¤„ç† |
| `referral-anti-fraud.test.ts` | åæ¬ºè¯ˆç³»ç»Ÿæµ‹è¯• | æ¬ºè¯ˆæ£€æµ‹ã€é£é™©è¯„ä¼° |
| `referral-cache-performance.test.ts` | ç¼“å­˜æ€§èƒ½æµ‹è¯• | ç¼“å­˜ç­–ç•¥ã€å‘½ä¸­ç‡ä¼˜åŒ– |
| `referral-trigger-reward.test.ts` | å¥–åŠ±è§¦å‘é€»è¾‘ | æ¡ä»¶åˆ¤æ–­ã€å¥–åŠ±åˆ†é… |

### æ ¸å¿ƒä¸šåŠ¡æµ‹è¯• (6ä¸ªæ–‡ä»¶)

| æ–‡ä»¶å | ä¸»è¦åŠŸèƒ½ | æµ‹è¯•åœºæ™¯ |
|--------|----------|----------|
| `auth.test.ts` | ç”¨æˆ·è®¤è¯ç³»ç»Ÿ | ç™»å½•ã€æ³¨å†Œã€JWTå¤„ç† |
| `business-flow.test.ts` | ä¸šåŠ¡æµç¨‹æµ‹è¯• | è®¢å•æµç¨‹ã€æ”¯ä»˜æµç¨‹ |
| `lottery-algorithm.test.ts` | æŠ½å¥–ç®—æ³• | éšæœºæ•°ç”Ÿæˆã€å¼€å¥–é€»è¾‘ |
| `lottery-referral-integration.test.ts` | æŠ½å¥–é‚€è¯·é›†æˆ | å¤åˆä¸šåŠ¡æµç¨‹ |
| `behavior-monitor.test.ts` | è¡Œä¸ºç›‘æ§ | ç”¨æˆ·è¡Œä¸ºåˆ†æ |
| `database-transactions.test.ts` | æ•°æ®åº“äº‹åŠ¡ | ACIDç‰¹æ€§ã€å¹¶å‘æ§åˆ¶ |

### æ€§èƒ½å’Œä¼˜åŒ–æµ‹è¯• (5ä¸ªæ–‡ä»¶)

| æ–‡ä»¶å | ä¸»è¦åŠŸèƒ½ | æµ‹è¯•åœºæ™¯ |
|--------|----------|----------|
| `performance-cache.test.ts` | ç¼“å­˜ç³»ç»Ÿæ€§èƒ½ | ç¼“å­˜ç­–ç•¥ã€å“åº”æ—¶é—´ |
| `referral-performance.test.ts` | é‚€è¯·ç³»ç»Ÿæ€§èƒ½ | å¤„ç†é€Ÿåº¦ã€èµ„æºå ç”¨ |
| `database-lock.test.ts` | æ•°æ®åº“é”æœºåˆ¶ | é”ç«äº‰ã€æ­»é”æ£€æµ‹ |
| `api-security.test.ts` | APIå®‰å…¨æµ‹è¯• | èº«ä»½éªŒè¯ã€æˆæƒæ£€æŸ¥ |
| `bot-fault-tolerance.test.ts` | æœºå™¨äººå®¹é”™æµ‹è¯• | é”™è¯¯å¤„ç†ã€æ¢å¤æœºåˆ¶ |

### é…ç½®å’Œå·¥å…·æµ‹è¯• (7ä¸ªæ–‡ä»¶)

| æ–‡ä»¶å | ä¸»è¦åŠŸèƒ½ | æµ‹è¯•åœºæ™¯ |
|--------|----------|----------|
| `reward-config-manager.test.ts` | å¥–åŠ±é…ç½®ç®¡ç† | é…ç½®æ›´æ–°ã€ç‰ˆæœ¬æ§åˆ¶ |
| `reward-config-batch-update.test.ts` | æ‰¹é‡é…ç½®æ›´æ–° | æ‰¹é‡æ“ä½œã€äº‹åŠ¡ä¸€è‡´æ€§ |
| `reward-config-update-api.test.ts` | é…ç½®æ›´æ–°API | RESTæ¥å£ã€å‚æ•°éªŒè¯ |
| `qr-generator.test.ts` | äºŒç»´ç ç”Ÿæˆ | ç¼–ç è§£ç ã€å®¹é”™æ€§ |
| `referral-anti-fraud-accuracy.test.ts` | åæ¬ºè¯ˆå‡†ç¡®æ€§ | æ£€æµ‹ç²¾åº¦ã€è¯¯æŠ¥ç‡ |
| `referral-rebate-accuracy.test.ts` | è¿”åˆ©è®¡ç®—å‡†ç¡®æ€§ | è®¡ç®—ç²¾åº¦ã€å››èˆäº”å…¥ |
| `referral-reward-compatibility.test.ts` | å¥–åŠ±å…¼å®¹æ€§ | ç‰ˆæœ¬å…¼å®¹ã€è¿ç§»æµ‹è¯• |

## ğŸ“š æ–‡æ¡£èµ„æº

- [æµ‹è¯•æ¡†æ¶å®ŒæˆæŠ¥å‘Š](./TESTING_FRAMEWORK_COMPLETION_REPORT.md) - è¯¦ç»†çš„é¡¹ç›®çŠ¶æ€å’Œå®ç°æƒ…å†µ
- [æµ‹è¯•ç¯å¢ƒé…ç½®æŒ‡å—](./TESTING_ENVIRONMENT_SETUP_GUIDE.md) - å®Œæ•´çš„é…ç½®æ­¥éª¤å’Œæ•…éšœæ’é™¤
- [é¡¹ç›®å®ŒæˆæŠ¥å‘Šé›†åˆ](../README.md#é¡¹ç›®å®ŒæˆæŠ¥å‘Š) - æ•´ä½“é¡¹ç›®çŠ¶æ€

## ğŸ” è´¨é‡ä¿è¯

### æµ‹è¯•åŸåˆ™

1. **ç‹¬ç«‹æ€§**: æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹ç‹¬ç«‹æ‰§è¡Œ
2. **å¯é æ€§**: æµ‹è¯•ç»“æœç¨³å®šå¯é‡ç°
3. **å®Œæ•´æ€§**: è¦†ç›–æ‰€æœ‰å…³é”®ä¸šåŠ¡é€»è¾‘
4. **æ€§èƒ½**: æ»¡è¶³æ€§èƒ½åŸºå‡†è¦æ±‚
5. **å¯ç»´æŠ¤æ€§**: ä»£ç ç»“æ„æ¸…æ™°ï¼Œæ˜“äºç»´æŠ¤

### ä»£ç è´¨é‡æ ‡å‡†

- **ç±»å‹å®‰å…¨**: 100% TypeScriptè¦†ç›–
- **ESLintåˆè§„**: æ— è­¦å‘Šå’Œé”™è¯¯
- **æµ‹è¯•è¦†ç›–ç‡**: â‰¥90% æ‰€æœ‰æŒ‡æ ‡
- **æ–‡æ¡£å®Œæ•´æ€§**: æ‰€æœ‰å…¬å…±APIæœ‰æ–‡æ¡£

## ğŸš¨ å¸¸è§é—®é¢˜

### Q: æ•°æ®åº“è¿æ¥å¤±è´¥æ€ä¹ˆåŠï¼Ÿ
A: æ£€æŸ¥ `.env.local` æ–‡ä»¶ä¸­çš„ `DATABASE_URL` æ˜¯å¦æ­£ç¡®é…ç½®ï¼Œç¡®ä¿æ•°æ®åº“å¯è®¿é—®ã€‚

### Q: æµ‹è¯•æ‰§è¡Œæ—¶é—´è¿‡é•¿ï¼Ÿ
A: ä½¿ç”¨å¹¶è¡Œæµ‹è¯•ï¼š`npm test -- --maxWorkers=4`ï¼Œæˆ–è·³è¿‡è¦†ç›–ç‡æ”¶é›†ï¼š`npm test -- --coverage=false`ã€‚

### Q: å¦‚ä½•æ·»åŠ æ–°çš„æµ‹è¯•æ–‡ä»¶ï¼Ÿ
A: åœ¨ `__tests__/` ç›®å½•ä¸‹åˆ›å»º `.test.ts` æ–‡ä»¶ï¼ŒJestä¼šè‡ªåŠ¨å‘ç°å¹¶æ‰§è¡Œã€‚

### Q: è¦†ç›–ç‡ä¸è¾¾æ ‡æ€ä¹ˆåŠï¼Ÿ
A: æŸ¥çœ‹HTMLè¦†ç›–ç‡æŠ¥å‘Šï¼Œè¡¥å……ç¼ºå¤±çš„æµ‹è¯•ç”¨ä¾‹ï¼Œé‡ç‚¹å…³æ³¨ä¸šåŠ¡é€»è¾‘å’Œè¾¹ç•Œæ¡ä»¶ã€‚

## ğŸ“ˆ æŒç»­æ”¹è¿›

### å®šæœŸç»´æŠ¤ä»»åŠ¡

- [ ] æ¯å‘¨è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
- [ ] æ¯æœˆå®¡æŸ¥è¦†ç›–ç‡æŠ¥å‘Š
- [ ] æ¯å­£åº¦æ›´æ–°æµ‹è¯•æ•°æ®
- [ ] æŒç»­ä¼˜åŒ–æµ‹è¯•æ€§èƒ½

### æœªæ¥è§„åˆ’

- [ ] æ·»åŠ è§†è§‰å›å½’æµ‹è¯•
- [ ] é›†æˆç«¯åˆ°ç«¯æµ‹è¯•æ¡†æ¶
- [ ] å¢å¼ºæ€§èƒ½ç›‘æ§
- [ ] å®ç°æµ‹è¯•è‡ªåŠ¨åŒ–CI/CD

---

**é¡¹ç›®çŠ¶æ€**: âœ… æµ‹è¯•æ¡†æ¶å·²å®Œæˆï¼ˆå¾…æ•°æ®åº“ç¯å¢ƒé…ç½®ï¼‰  
**æœ€åæ›´æ–°**: 2025-10-31  
**ç‰ˆæœ¬**: v1.0

*å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒ [TESTING_ENVIRONMENT_SETUP_GUIDE.md](./TESTING_ENVIRONMENT_SETUP_GUIDE.md) è¿›è¡Œæ•…éšœæ’é™¤ã€‚*