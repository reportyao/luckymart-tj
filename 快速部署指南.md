# LuckyMart TJ ç§»åŠ¨ç«¯ä¼˜åŒ– - å¿«é€Ÿéƒ¨ç½²æŒ‡å—

## ğŸ“‹ éƒ¨ç½²æ–¹å¼é€‰æ‹©

ç”±äºworkspace SSHå·¥å…·é™åˆ¶ï¼Œæä¾›**3ç§éƒ¨ç½²æ–¹å¼**ä¾›æ‚¨é€‰æ‹©ï¼š

---

## ğŸš€ æ–¹å¼1ï¼šSCPä¸Šä¼ éƒ¨ç½²ï¼ˆæ¨èï¼‰

### Step 1: ä¸‹è½½éƒ¨ç½²åŒ…
ä»workspaceä¸‹è½½æ–‡ä»¶ï¼š
```
/workspace/luckymart-tj/mobile_optimization_files.tar.gz  (20KB)
```

### Step 2: ä¸Šä¼ åˆ°æœåŠ¡å™¨
```bash
# åœ¨æ‚¨çš„æœ¬åœ°ç”µè„‘æ‰§è¡Œ
scp /path/to/mobile_optimization_files.tar.gz root@47.243.83.253:/tmp/
# å¯†ç : Lingjiu123@
```

### Step 3: SSHç™»å½•å¹¶éƒ¨ç½²
```bash
ssh root@47.243.83.253
# å¯†ç : Lingjiu123@

# è§£å‹éƒ¨ç½²åŒ…
cd /tmp
tar -xzf mobile_optimization_files.tar.gz

# è¿›å…¥é¡¹ç›®ç›®å½•
cd /var/www/luckymart-tj

# å¤‡ä»½å½“å‰ä»£ç 
mkdir -p ~/backup-mobile-$(date +%s)
cp -r components app types contexts prisma ~/backup-mobile-$(date +%s)/

# å¤åˆ¶ä¼˜åŒ–æ–‡ä»¶
cp -f /tmp/components/*.tsx ./components/
cp -f /tmp/app/page.tsx ./app/
cp -f /tmp/app/product/\[id\]/page.tsx ./app/product/[id]/
cp -f /tmp/app/admin/products/create/page.tsx ./app/admin/products/create/
cp -f /tmp/types/index.ts ./types/
cp -f /tmp/contexts/LanguageContext.tsx ./contexts/
cp -f /tmp/prisma/schema.prisma ./prisma/

# ç”ŸæˆPrismaå®¢æˆ·ç«¯
npx prisma generate

# é‡å¯æœåŠ¡
pm2 restart luckymart-web

# éªŒè¯éƒ¨ç½²
pm2 status
pm2 logs luckymart-web --lines 20
```

---

## âš¡ æ–¹å¼2ï¼šä¸€é”®éƒ¨ç½²è„šæœ¬

### Step 1: ä¸‹è½½éƒ¨ç½²åŒ…ï¼ˆåŒä¸Šï¼‰

### Step 2: ä¸Šä¼ å¹¶æ‰§è¡Œè„šæœ¬
```bash
# ä¸Šä¼ éƒ¨ç½²åŒ…
scp mobile_optimization_files.tar.gz root@47.243.83.253:/tmp/

# SSHç™»å½•
ssh root@47.243.83.253

# è§£å‹
cd /tmp
tar -xzf mobile_optimization_files.tar.gz

# è¿è¡Œéƒ¨ç½²è„šæœ¬
cd /var/www/luckymart-tj
bash /tmp/deploy_mobile_optimization.sh
```

---

## ğŸ“ æ–¹å¼3ï¼šæ‰‹åŠ¨å¤åˆ¶ç²˜è´´ï¼ˆæ— éœ€ä¸‹è½½ï¼‰

å¦‚æœæ— æ³•ä¸‹è½½æ–‡ä»¶ï¼Œå¯ä»¥æ‰‹åŠ¨å¤åˆ¶æ–‡ä»¶å†…å®¹ï¼š

### æ ¸å¿ƒæ–‡ä»¶åˆ—è¡¨
éœ€è¦æ›´æ–°ä»¥ä¸‹9ä¸ªæ–‡ä»¶ï¼š

#### 1. components/MobileNavigation.tsx (æ–°å»º)
```bash
# SSHç™»å½•æœåŠ¡å™¨
ssh root@47.243.83.253
cd /var/www/luckymart-tj/components

# åˆ›å»ºæ–‡ä»¶å¹¶ç²˜è´´å†…å®¹ï¼ˆä»ä¸‹æ–¹è·å–ï¼‰
nano MobileNavigation.tsx
```
**æ–‡ä»¶å†…å®¹è§**: é™„å½•A

#### 2. components/ProductImageCarousel.tsx (æ–°å»º)
```bash
nano ProductImageCarousel.tsx
```
**æ–‡ä»¶å†…å®¹è§**: é™„å½•B

#### 3. components/MarketingBadgeDisplay.tsx (æ–°å»º)
```bash
nano MarketingBadgeDisplay.tsx
```
**æ–‡ä»¶å†…å®¹è§**: é™„å½•C

#### 4-9. å…¶ä»–æ–‡ä»¶
- app/page.tsxï¼ˆä¿®æ”¹ï¼‰
- app/product/[id]/page.tsxï¼ˆä¿®æ”¹ï¼‰
- app/admin/products/create/page.tsxï¼ˆä¿®æ”¹ï¼‰
- types/index.tsï¼ˆä¿®æ”¹ï¼‰
- contexts/LanguageContext.tsxï¼ˆä¿®æ”¹ï¼‰
- prisma/schema.prismaï¼ˆå·²åŒ…å«å­—æ®µï¼‰

**è¯¦ç»†å†…å®¹è¯·æŸ¥çœ‹**: `MOBILE_OPTIMIZATION_FINAL_DEPLOY.md`

---

## ğŸ—„ï¸ æ•°æ®åº“Migration

### âš ï¸ é‡è¦ï¼šéœ€è¦Supabaseæˆæƒ

ç”±äºæ•°æ®åº“migrationéœ€è¦Supabase projectæˆæƒï¼Œæœ‰**2ç§æ‰§è¡Œæ–¹å¼**ï¼š

### æ–¹å¼Aï¼šä½¿ç”¨Prisma Migrationï¼ˆæ¨èï¼‰
```bash
cd /var/www/luckymart-tj
npx prisma migrate deploy
```

å¦‚æœæç¤ºæˆæƒé”™è¯¯ï¼Œä½¿ç”¨æ–¹å¼Bã€‚

### æ–¹å¼Bï¼šæ‰‹åŠ¨æ‰§è¡ŒSQL
1. è®¿é—®Supabaseæ§åˆ¶å°
2. è¿›å…¥SQL Editor
3. æ‰§è¡Œä»¥ä¸‹SQLï¼š

```sql
-- æ·»åŠ è¥é”€è§’æ ‡å­—æ®µ
ALTER TABLE products 
ADD COLUMN IF NOT EXISTS marketing_badge JSONB DEFAULT NULL;

-- æ·»åŠ æ³¨é‡Š
COMMENT ON COLUMN products.marketing_badge IS 
'Marketing badge config: {type, nameZh, nameEn, nameRu, color, bgColor, position, animated}';

-- åˆ›å»ºGINç´¢å¼•ï¼ˆå¯é€‰ï¼Œæå‡æŸ¥è¯¢æ€§èƒ½ï¼‰
CREATE INDEX IF NOT EXISTS idx_products_marketing_badge 
ON products USING gin(marketing_badge) 
WHERE marketing_badge IS NOT NULL;

-- éªŒè¯å­—æ®µå·²æ·»åŠ 
SELECT column_name, data_type 
FROM information_schema.columns 
WHERE table_name = 'products' 
AND column_name = 'marketing_badge';
```

---

## âœ… éƒ¨ç½²éªŒè¯

éƒ¨ç½²å®Œæˆåï¼Œåœ¨æ‰‹æœºæµè§ˆå™¨è®¿é—®ï¼šhttp://47.243.83.253:3000

### éªŒè¯æ¸…å•
- [ ] ç§»åŠ¨ç«¯å¯¼èˆª - å·¦ä¸Šè§’æ˜¾ç¤ºæ±‰å ¡èœå•å›¾æ ‡ï¼Œç‚¹å‡»å¼¹å‡ºä¾§è¾¹æ 
- [ ] é¦–é¡µå¸ƒå±€ - æ‰‹æœºç«¯æ˜¾ç¤º2åˆ—å•†å“ç½‘æ ¼
- [ ] å•†å“è¯¦æƒ… - å›¾ç‰‡è½®æ’­åŠŸèƒ½ï¼Œå¯å·¦å³æ»‘åŠ¨
- [ ] è¥é”€è§’æ ‡ - ï¼ˆéœ€åœ¨ç®¡ç†åå°é…ç½®å•†å“è§’æ ‡åæµ‹è¯•ï¼‰
- [ ] å›¾ç‰‡æ€§èƒ½ - é¡µé¢åŠ è½½æ˜æ˜¾åŠ å¿«

### æµ‹è¯•ç§»åŠ¨ç«¯
```bash
# Chrome DevTools
F12 > Toggle Device Toolbar (Ctrl+Shift+M)
é€‰æ‹©è®¾å¤‡: iPhone 12 Pro (390x844)
```

---

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜1: PM2æœåŠ¡é‡å¯å¤±è´¥
```bash
# æŸ¥çœ‹æ—¥å¿—
pm2 logs luckymart-web --lines 50

# é‡æ–°å¯åŠ¨
pm2 delete luckymart-web
pm2 start npm --name "luckymart-web" -- run dev
```

### é—®é¢˜2: ç»„ä»¶æœªç”Ÿæ•ˆ
```bash
# æ¸…é™¤ç¼“å­˜
cd /var/www/luckymart-tj
rm -rf .next
npx prisma generate
pm2 restart luckymart-web --update-env

# æµè§ˆå™¨ç¡¬åˆ·æ–°ï¼šCtrl+Shift+R
```

### é—®é¢˜3: Migrationæ‰§è¡Œå¤±è´¥
```bash
# æ£€æŸ¥Prismaè¿æ¥
npx prisma migrate status

# æ‰‹åŠ¨æ‰§è¡ŒSQLï¼ˆè§ä¸Šæ–¹"æ–¹å¼B"ï¼‰
```

---

## ğŸ“Š éƒ¨ç½²å®Œæˆç¡®è®¤

| é¡¹ç›® | çŠ¶æ€ | å¤‡æ³¨ |
|------|------|------|
| ä»£ç æ–‡ä»¶å·²æ›´æ–° | [ ] | 9ä¸ªæ–‡ä»¶ |
| Migrationå·²æ‰§è¡Œ | [ ] | marketing_badgeå­—æ®µ |
| Prismaå®¢æˆ·ç«¯å·²ç”Ÿæˆ | [ ] | npx prisma generate |
| PM2æœåŠ¡å·²é‡å¯ | [ ] | pm2 restart |
| ç§»åŠ¨ç«¯å¯¼èˆªæµ‹è¯• | [ ] | æ±‰å ¡èœå• |
| é¦–é¡µå¸ƒå±€æµ‹è¯• | [ ] | 2åˆ—ç½‘æ ¼ |
| å›¾ç‰‡è½®æ’­æµ‹è¯• | [ ] | æ»‘åŠ¨åˆ‡æ¢ |

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æä¾›ï¼š
1. é”™è¯¯æ—¥å¿—ï¼š`pm2 logs luckymart-web --lines 100`
2. MigrationçŠ¶æ€ï¼š`npx prisma migrate status`
3. æœåŠ¡çŠ¶æ€ï¼š`pm2 status`

---

**éƒ¨ç½²æ—¶é—´**: $(date)  
**é¡¹ç›®ç‰ˆæœ¬**: v1.0.0 Mobile Optimization  
**æœåŠ¡å™¨**: 47.243.83.253:3000
