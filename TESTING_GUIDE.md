# LuckyMart TJ æµ‹è¯•å¥—ä»¶ä½¿ç”¨æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

LuckyMart TJ é¡¹ç›®å®ç°äº†å®Œæ•´çš„å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•è¦†ç›–ï¼Œç¡®ä¿ç³»ç»Ÿçš„ç¨³å®šæ€§ã€å®‰å…¨æ€§å’Œæ€§èƒ½ã€‚æœ¬æŒ‡å—å°†è¯¦ç»†ä»‹ç»å¦‚ä½•ä½¿ç”¨æµ‹è¯•å¥—ä»¶ã€‚

## ğŸ—ï¸ æµ‹è¯•æ¶æ„

### æµ‹è¯•ç±»å‹
- **å•å…ƒæµ‹è¯•** - æµ‹è¯•å•ä¸ªå‡½æ•°å’Œæ¨¡å—
- **é›†æˆæµ‹è¯•** - æµ‹è¯•æ¨¡å—é—´çš„äº¤äº’
- **æ€§èƒ½æµ‹è¯•** - éªŒè¯ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡
- **å®‰å…¨æµ‹è¯•** - éªŒè¯å®‰å…¨é˜²æŠ¤æœºåˆ¶
- **å®¹é”™æµ‹è¯•** - éªŒè¯é”™è¯¯å¤„ç†èƒ½åŠ›

### æµ‹è¯•æ–‡ä»¶ç»“æ„
```
luckymart-tj/
â”œâ”€â”€ __tests__/                    # Jestæµ‹è¯•æ–‡ä»¶
â”‚   â”œâ”€â”€ auth.test.ts             # JWTè®¤è¯ç³»ç»Ÿæµ‹è¯•
â”‚   â”œâ”€â”€ lottery-algorithm.test.ts # VRFå¼€å¥–ç®—æ³•æµ‹è¯•
â”‚   â”œâ”€â”€ database-lock.test.ts    # æ•°æ®åº“é”æœºåˆ¶æµ‹è¯•
â”‚   â”œâ”€â”€ api-security.test.ts     # APIå®‰å…¨éªŒè¯æµ‹è¯•
â”‚   â”œâ”€â”€ performance-cache.test.ts # æ€§èƒ½ä¼˜åŒ–ç¼“å­˜æµ‹è¯•
â”‚   â”œâ”€â”€ bot-fault-tolerance.test.ts # Botå®¹é”™æœºåˆ¶æµ‹è¯•
â”‚   â”œâ”€â”€ business-flow.test.ts    # æ ¸å¿ƒä¸šåŠ¡æµç¨‹æµ‹è¯•
â”‚   â””â”€â”€ database-transactions.test.ts # æ•°æ®åº“äº‹åŠ¡æµ‹è¯•
â”œâ”€â”€ test/                        # å…¶ä»–æµ‹è¯•æ–‡ä»¶
â”‚   â”œâ”€â”€ cache-system.test.ts     # ç¼“å­˜ç³»ç»Ÿæµ‹è¯•
â”‚   â””â”€â”€ [performance tests]
â”œâ”€â”€ jest.config.js              # Jesté…ç½®
â”œâ”€â”€ jest.setup.js               # æµ‹è¯•ç¯å¢ƒè®¾ç½®
â””â”€â”€ run-all-tests.ts            # æµ‹è¯•è¿è¡Œå™¨
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–
```bash
npm install
# æˆ–ä½¿ç”¨å¿«é€Ÿå®‰è£…
./run-tests.sh --setup
```

### 2. è¿è¡Œæ‰€æœ‰æµ‹è¯•
```bash
# ä½¿ç”¨ä¾¿æ·è„šæœ¬ï¼ˆæ¨èï¼‰
./run-tests.sh

# æˆ–ä½¿ç”¨npmå‘½ä»¤
npm run test:all

# æˆ–ä½¿ç”¨tsxç›´æ¥è¿è¡Œ
npx tsx run-all-tests.ts
```

### 3. æŸ¥çœ‹æµ‹è¯•æŠ¥å‘Š
æµ‹è¯•å®Œæˆåä¼šç”Ÿæˆï¼š
- `TEST_REPORT.md` - Markdownæ ¼å¼è¯¦ç»†æŠ¥å‘Š
- `test-report.json` - JSONæ ¼å¼æ•°æ®æŠ¥å‘Š
- `coverage/` - ä»£ç è¦†ç›–ç‡æŠ¥å‘Šç›®å½•

## ğŸ“Š æµ‹è¯•å‘½ä»¤è¯¦è§£

### å•ä¸ªæµ‹è¯•å¥—ä»¶
```bash
# è®¤è¯ç³»ç»Ÿæµ‹è¯•
npm run test:auth

# VRFç®—æ³•æµ‹è¯•
npm run test:lottery

# ä¸šåŠ¡æµç¨‹æµ‹è¯•
npm run test:business

# APIå®‰å…¨æµ‹è¯•
npm run test:security

# æ€§èƒ½æµ‹è¯•
npm run test:performance-suite

# Botå®¹é”™æµ‹è¯•
npm run test:bot
```

### æµ‹è¯•ç±»å‹åˆ†ç±»
```bash
# å•å…ƒæµ‹è¯•
npm run test:unit

# é›†æˆæµ‹è¯•
npm run test:integration

# æ€§èƒ½æµ‹è¯•
npm run test:performance
```

### è¦†ç›–ç‡æµ‹è¯•
```bash
# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
npm run test:coverage

# æŸ¥çœ‹å®æ—¶è¦†ç›–ç‡
npm run test:watch
```

## ğŸ”§ æµ‹è¯•é…ç½®

### Jesté…ç½® (jest.config.js)
- æµ‹è¯•ç¯å¢ƒï¼šNode.js
- è¦†ç›–ç‡é˜ˆå€¼ï¼š70%
- æ¨¡å—åˆ«åï¼š@/ æŒ‡å‘æ ¹ç›®å½•
- è¶…æ—¶æ—¶é—´ï¼š30ç§’

### ç¯å¢ƒå˜é‡
æµ‹è¯•ä¼šè‡ªåŠ¨åŠ è½½ `.env.local` æ–‡ä»¶ï¼Œéœ€è¦é…ç½®ï¼š
```env
DATABASE_URL="postgresql://..."
JWT_SECRET="your-jwt-secret"
TELEGRAM_BOT_TOKEN="your-bot-token"
REDIS_URL="redis://..."
```

### æµ‹è¯•æ•°æ®
æµ‹è¯•ä½¿ç”¨ç‹¬ç«‹çš„æµ‹è¯•æ•°æ®ï¼Œè¿è¡Œå‰ä¼šè‡ªåŠ¨æ¸…ç†å’Œé‡å»ºã€‚

## ğŸ“ˆ è¦†ç›–èŒƒå›´

### è®¤è¯ç³»ç»Ÿ
- âœ… JWT Tokenç”Ÿæˆå’ŒéªŒè¯
- âœ… å¯†ç åŠ å¯†å’Œå®‰å…¨å¤„ç†
- âœ… Telegram WebAppéªŒè¯
- âœ… æƒé™è¾¹ç•Œæ§åˆ¶

### VRFå¼€å¥–ç®—æ³•
- âœ… å¯†ç å­¦éšæœºæ•°ç”Ÿæˆ
- âœ… å¼€å¥–ç»“æœå…¬å¹³æ€§éªŒè¯
- âœ… é˜²ç¯¡æ”¹å’Œå®‰å…¨é˜²æŠ¤
- âœ… ç®—æ³•æ€§èƒ½æµ‹è¯•

### æ•°æ®åº“æ“ä½œ
- âœ… äº‹åŠ¡åŸå­æ€§ä¿è¯
- âœ… å¹¶å‘æ“ä½œå®‰å…¨æ€§
- âœ… é”æœºåˆ¶æµ‹è¯•
- âœ… æ­»é”æ£€æµ‹å’Œå¤„ç†

### APIå®‰å…¨
- âœ… è®¤è¯å’Œæˆæƒ
- âœ… è¾“å…¥éªŒè¯
- âœ… å®‰å…¨å¤´è®¾ç½®
- âœ… æƒé™æ§åˆ¶

### æ€§èƒ½ä¼˜åŒ–
- âœ… N+1æŸ¥è¯¢æ£€æµ‹
- âœ… ç¼“å­˜ç³»ç»Ÿæµ‹è¯•
- âœ… æŸ¥è¯¢ä¼˜åŒ–éªŒè¯
- âœ… å†…å­˜ä½¿ç”¨ä¼˜åŒ–

### Botå®¹é”™
- âœ… é”™è¯¯å¤„ç†æœºåˆ¶
- âœ… é‡è¿æœºåˆ¶
- âœ… æ¶ˆæ¯é˜Ÿåˆ—
- âœ… å¥åº·ç›‘æ§

### ä¸šåŠ¡æµç¨‹
- âœ… ç”¨æˆ·æ³¨å†Œæµç¨‹
- âœ… å¤ºå®å‚ä¸æµç¨‹
- âœ… å¼€å¥–å¤„ç†æµç¨‹
- âœ… è®¢å•ç®¡ç†æµç¨‹

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æµ‹è¯•è¶…æ—¶**
   ```bash
   # å¢åŠ è¶…æ—¶æ—¶é—´æˆ–ä¼˜åŒ–æµ‹è¯•
   export JEST_TIMEOUT=60000
   ```

2. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥DATABASE_URLé…ç½®
   # ç¡®ä¿æ•°æ®åº“æœåŠ¡è¿è¡Œ
   npm run prisma:migrate
   ```

3. **ä¾èµ–ç¼ºå¤±**
   ```bash
   # é‡æ–°å®‰è£…ä¾èµ–
   rm -rf node_modules package-lock.json
   npm install
   ```

4. **è¦†ç›–ç‡ä¸è¾¾æ ‡**
   ```bash
   # æŸ¥çœ‹è¯¦ç»†è¦†ç›–ç‡æŠ¥å‘Š
   npm run test:coverage
   open coverage/lcov-report/index.html
   ```

### è°ƒè¯•æ¨¡å¼
```bash
# è¯¦ç»†è¾“å‡º
npm test -- --verbose

# ç›‘å¬æ¨¡å¼
npm run test:watch

# è°ƒè¯•ç‰¹å®šæµ‹è¯•
npm test -- --testNamePattern="ç‰¹å®šæµ‹è¯•åç§°"
```

## ğŸ“Š æµ‹è¯•æŒ‡æ ‡

### è¦†ç›–ç‡è¦æ±‚
- **ä»£ç è¡Œ**: â‰¥70%
- **å‡½æ•°**: â‰¥70%
- **åˆ†æ”¯**: â‰¥70%
- **è¯­å¥**: â‰¥70%

### æ€§èƒ½åŸºå‡†
- **JWT Tokenç”Ÿæˆ**: <1ms
- **VRFå¼€å¥–è®¡ç®—**: <5s
- **ç¼“å­˜å‘½ä¸­ç‡**: >90%
- **å¹¶å‘å¤„ç†**: >100 TPS

### è´¨é‡æ ‡å‡†
- **æµ‹è¯•é€šè¿‡ç‡**: â‰¥95%
- **å®‰å…¨åŠŸèƒ½**: 100%éªŒè¯
- **å…³é”®è·¯å¾„**: 100%è¦†ç›–

## ğŸ” æŒç»­é›†æˆ

### CI/CDé›†æˆ
å°†æµ‹è¯•é›†æˆåˆ°æŒç»­é›†æˆæµæ°´çº¿ï¼š
```yaml
# .github/workflows/test.yml
name: Tests
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v2
        with:
          node-version: '20'
      - run: npm ci
      - run: npm run test:all
      - run: npm run test:coverage
```

### é¢„æäº¤é’©å­
```bash
# å®‰è£…husky
npm install --save-dev husky

# è®¾ç½®é¢„æäº¤æ£€æŸ¥
npx husky install
npx husky add .husky/pre-commit "npm run test:unit"
```

## ğŸ“š å‚è€ƒæ–‡æ¡£

### æµ‹è¯•æ¡†æ¶æ–‡æ¡£
- [Jestå®˜æ–¹æ–‡æ¡£](https://jestjs.io/)
- [Testing Library](https://testing-library.com/)
- [Prismaæµ‹è¯•æŒ‡å—](https://www.prisma.io/docs/guides/testing)

### é¡¹ç›®æ–‡æ¡£
- [COMPLETE_TEST_REPORT.md](./COMPLETE_TEST_REPORT.md) - å®Œæ•´æµ‹è¯•æŠ¥å‘Š
- [README.md](./README.md) - é¡¹ç›®æ€»ä½“è¯´æ˜
- [APIæ–‡æ¡£](./docs/api/) - APIæ¥å£æ–‡æ¡£

## ğŸ¯ æœ€ä½³å®è·µ

1. **æµ‹è¯•é©±åŠ¨å¼€å‘** - å…ˆå†™æµ‹è¯•å†å†™ä»£ç 
2. **å®šæœŸè¿è¡Œæµ‹è¯•** - æ¯æ¬¡æäº¤å‰è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
3. **è¦†ç›–ç‡ç›‘æ§** - ä¿æŒæµ‹è¯•è¦†ç›–ç‡åœ¨æ ‡å‡†ä¹‹ä¸Š
4. **æ€§èƒ½åŸºå‡†** - å®šæœŸæ£€æŸ¥æ€§èƒ½æŒ‡æ ‡
5. **å®‰å…¨å®¡è®¡** - å®šæœŸè¿›è¡Œå®‰å…¨æµ‹è¯•

## ğŸ“ æ”¯æŒ

å¦‚æœ‰æµ‹è¯•ç›¸å…³é—®é¢˜ï¼Œè¯·ï¼š
1. æŸ¥çœ‹æœ¬æŒ‡å—å’Œé¡¹ç›®æ–‡æ¡£
2. è¿è¡Œè¯¦ç»†æµ‹è¯•è·å–é”™è¯¯ä¿¡æ¯
3. æ£€æŸ¥ç¯å¢ƒé…ç½®å’Œä¾èµ–
4. æäº¤Issueå¹¶é™„ä¸Šæµ‹è¯•æŠ¥å‘Š

---

*æœ¬æŒ‡å—æ¶µç›–äº†LuckyMart TJé¡¹ç›®æµ‹è¯•å¥—ä»¶çš„å®Œæ•´ä½¿ç”¨è¯´æ˜ã€‚å¦‚æœ‰ä»»ä½•ç–‘é—®æˆ–å»ºè®®ï¼Œæ¬¢è¿åé¦ˆã€‚*